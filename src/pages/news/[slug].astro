---
import MainLayout from '../../layouts/MainLayout.astro';
import { getCollection } from 'astro:content';
import { formatDate } from '../../utils/formatDate';

// Generate static paths for all news articles
export async function getStaticPaths() {
  const news = await getCollection('news', ({ data }) => {
    return import.meta.env.PROD ? !data.draft : true;
  });

  return news.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

// Get the post data from props
const { post } = Astro.props;
const { Content } = await post.render();
const { title, pubDate, coverImage, author, tags } = post.data;

// Format date
const formattedDate = formatDate(pubDate);
---

<MainLayout
  title={`${title} - Astro Starter Theme`}
  description={post.data.description}
>
  <article class='article'>
    <div class='article-header'>
      <div class='container'>
        <div class='max-w-3xl mx-auto text-center'>
          {
            tags && tags.length > 0 && (
              <div class='article-tags'>
                {tags.map((tag) => (
                  <span class='tag'>{tag}</span>
                ))}
              </div>
            )
          }

          <h1 class='article-title'>{title}</h1>

          <div class='article-meta'>
            <time datetime={pubDate}>{formattedDate}</time>
            {author && <span class='article-author'>By {author}</span>}
          </div>
        </div>
      </div>
    </div>

    {
      coverImage && (
        <div class='article-featured-image'>
          <div class='container'>
            <img
              src={coverImage}
              alt={title}
              class='mx-auto'
              width='1200'
              height='600'
            />
          </div>
        </div>
      )
    }

    <div class='article-content'>
      <div class='container'>
        <div class='content-wrapper max-w-3xl mx-auto flow'>
          <Content />
        </div>
      </div>
    </div>

    <div class='article-footer py-lg'>
      <div class='container'>
        <div class='max-w-3xl mx-auto'>
          <div class='article-navigation'>
            <a href='/news' class='btn btn-outline'>&larr; Back to All News</a>
          </div>
        </div>
      </div>
    </div>
  </article>
</MainLayout>

<style>
  .article-header {
    padding: 4rem 0 2rem;
  }

  .article-tags {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    margin-bottom: 1rem;
  }

  .tag {
    background-color: var(--color-primary-light);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    font-size: 0.875rem;
    font-weight: 500;
  }

  .article-title {
    font-size: clamp(2rem, 5vw, 3rem);
    margin-bottom: 1rem;
  }

  .article-meta {
    color: var(--color-text-light);
    font-size: 1rem;
    display: flex;
    gap: 1rem;
    justify-content: center;
    align-items: center;
  }

  .article-author {
    position: relative;
  }

  .article-author::before {
    content: 'â€¢';
    position: absolute;
    left: -0.6rem;
  }

  .article-featured-image {
    margin: 2rem 0;
  }

  .article-featured-image img {
    width: 100%;
    max-height: 500px;
    object-fit: cover;
    border-radius: 0.5rem;
  }

  .article-content {
    padding: 2rem 0 4rem;
  }

  .content-wrapper {
    --flow-space: 1.5rem;
  }

  .content-wrapper :global(h2) {
    margin-top: 2rem;
    margin-bottom: 1rem;
  }

  .content-wrapper :global(h3) {
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
  }

  .content-wrapper :global(img) {
    border-radius: 0.5rem;
    margin: 2rem 0;
  }

  .content-wrapper :global(blockquote) {
    border-left: 4px solid var(--color-primary);
    padding-left: 1rem;
    font-style: italic;
    margin: 2rem 0;
  }

  .article-navigation {
    display: flex;
    justify-content: space-between;
    margin-top: 3rem;
  }
</style>

